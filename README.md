# piastrix
Тестовое задание python dev API.
Необходимо разработать и реализовать flask сервис.Сервис состоит из одной страницы со
следующими элементами:
-
 Сумма оплаты (поле ввода суммы);
-
 Валюта оплаты (выпадающиййG список со значениями EUR, USD, RUB);
-
 Описание товара (многострочное поле ввода информации);
-
 Оплатить (кнопка);
При нажатии на кнопку “Оплатить”, происходит следующее:
-
 если валюта в выпадающем списке указана “EUR”, то пользователь направляется на
страницу оплаты без выбора направления (по протоколу Pay, стр. 3)
-
 если валюта указана “USD”, то осуществляется запрос на выставление счета на оплату
по API (метод Bill, стр. 4) в валюте Piastrix. Если получен корректный ответ,
пользователь должен перенаправляться на страницу оплаты платёжной системы
Piastrix (на url из ответа).
-
 если валюта указана “RUB”, то осуществляется запрос на выставление счета на оплату
по API (метод Invoice, стр. 6) с указанием обязательного параметра
payway=payeer_rub. Если получен корректныййG ответ, пользователь должен
перенаправляться на страницу оплаты платёжной системы Payeer.
-
 с указанием обязательного параметра payway=advcash_rub. Если получен
корректныййG ответ, пользователь должен перенаправляться на страницу оплаты
платёжной системы Advcash.
Во всех случаях необходимо предусмотреть логирование работы сервиса и хранение
следующей информации: валюта, сумма, время отправки, описание, идентификатор платежа
в БД или файл.
Готовое задание выложить на github (или подобный сервис), а приложение задеплоить на
heroku или любой другой хостинг.
Параметры для выполнения запросов: shop_id = 5
secretKey = SecretKey01
payway = payeer_rub (для invoice)
Правила формирования подписи (sign)
Строка формируется следующим образом: все обязательные параметры запроса
упорядочиваются в алфавитном порядке ключей, значения конкатенируются через знак
двоеточие (“:”), в конце добавляется секретный ключ (без знака ":"), от полученной строки
генерируется sha256 хеш и его HEX-представление передается в параметре запроса sign.
Для каждого метода свой набор обязательных параметров, также могут передаваться
дополнительные параметры, но в формировании подписи они не участвуют.
Пример формирования подписи для запроса invoice.
request = { "currency": "643", "sign":
"9cf003e3ad9da90ff00b06349b677261d5539f7e0540ˆ976c45537a141222c1", "payway":
"payeer_rub", "amount": "12.34", "shop_id": "5", "shop_order_id": 4126, "descripŠon": "Test
invoice"}
Секретный ключ магазина (из настроек магазина):
secret = “SecretKey01”
Cписок обязательных параметров для запроса invoice:
keys_required = ("shop_id", "payway", "amount", "currency", "shop_order_id")
Упорядоченные ключи:
keys_sorted = ['amount', 'currency', 'payway', 'shop_id', 'shop_order_id']
Строка для генерации sha256 хеша имеет вид:
12.34:643:payeer_rub:5:4126SecretKey01
HEX-представление хеша:
sign =
9cf003e3ad9da90ff00b06349b677261d5539f7e0540ˆ976c45537a141222c1
Для онлайн проверки можно использовать онлайн сервис
h’p://www.xorbin.com/tools/sha256-hash-calculator
Выставление счета для оплаты через PAY
Для перенаправления плательщика на страницу оплаты, необходимо сформировать и
подтвердить HTML-форму.
URL: h’ps://pay.piastrix.com/ru/pay или h’ps://pay.piastrix.com/en/pay
Метод: POST, GET
Обязательные параметры: amount, currency, shop_id, shop_order_id Пример формирования
подписи для запроса:
keys_sorted = ['amount', 'currency', 'shop_id', 'shop_order_id']
Строка для генерации sha256 хеша имеет вид: 10.00:643:5:101SecretKey01
HEX-представление хеша:
sign = e4580435a252d61ef91b71cb23ed7bee4d77de94ced36411526d2ce3b66ada8f
Пример HTML-формы:
<form name="Pay" method="post" acŠon=" h’ps://pay.piastrix.com/ru/pay" accept-
charset="UTF-8>
<input type="hidden" name="amount" value="10.00"/>
<input type="hidden" name="currency" value="643"/>
<input type="hidden" name="shop_id" value="5"/>
<input type="hidden" name="sign"
value="e4580435a252d61ef91b71cb23ed7bee4d77de94ced36411526d2ce3b6 6ada8f"/>
<input type="hidden" name="shop_order_id" value="101"/>
<input type="submit" input type="hidden" name="descripŠon" value="Test invoice"/>
< /form >



